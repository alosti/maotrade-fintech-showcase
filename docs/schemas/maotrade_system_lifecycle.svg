<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="800" height="600" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#333">
    Ciclo di Vita Trading System - MAOTrade
  </text>
  
  <!-- TradeMgr Box -->
  <rect x="320" y="60" width="160" height="40" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
  <text x="400" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1976d2">
    TradeMgr
  </text>
  
  <!-- IG Gateway Box (moved next to TradeMgr) -->
  <rect x="520" y="60" width="150" height="40" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
  <text x="595" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#c2185b">
    Broker Gateway
  </text>
  
  <!-- System Lifecycle Steps -->
  
  <!-- 1. Validation -->
  <rect x="50" y="140" width="140" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
  <text x="120" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f57c00">
    1. VALIDAZIONE
  </text>
  <text x="120" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    do_validate_signal()
  </text>
  <text x="120" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Parametri + Portfolio
  </text>
  
  <!-- 2. Initialization -->
  <rect x="220" y="140" width="140" height="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
  <text x="290" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#7b1fa2">
    2. INIZIALIZZAZIONE
  </text>
  <text x="290" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    do_init_system()
  </text>
  <text x="290" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Setup + Dati Storici
  </text>
  
  <!-- 3. Processing -->
  <rect x="440" y="140" width="140" height="60" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="5"/>
  <text x="510" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#388e3c">
    3. PROCESSING
  </text>
  <text x="510" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    do_process_data()
  </text>
  <text x="510" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Frame → Action
  </text>
  
  <!-- 4. Events -->
  <rect x="610" y="140" width="140" height="60" fill="#ffebee" stroke="#d32f2f" stroke-width="2" rx="5"/>
  <text x="680" y="160" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#d32f2f">
    4. EVENTI
  </text>
  <text x="680" y="175" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    on_order_filled()
  </text>
  <text x="680" y="188" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    on_market_data_error()
  </text>
  
  <!-- Data Sources -->
  
  <!-- Database -->
  <rect x="50" y="280" width="100" height="50" fill="#e1f5fe" stroke="#0277bd" stroke-width="2" rx="5"/>
  <text x="100" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#0277bd">
    Database
  </text>
  <text x="100" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Segnali + Config
  </text>
  
  <!-- Portfolio -->
  <rect x="180" y="280" width="100" height="50" fill="#f1f8e9" stroke="#689f38" stroke-width="2" rx="5"/>
  <text x="230" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#689f38">
    Portfolio
  </text>
  <text x="230" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Posizioni Correnti
  </text>
  
  <!-- Market Data -->
  <rect x="440" y="280" width="100" height="50" fill="#fff8e1" stroke="#ffa000" stroke-width="2" rx="5"/>
  <text x="490" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ffa000">
    Market Data
  </text>
  <text x="490" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    OHLC Real-time
  </text>
  
  <!-- System Actions (moved to the right) -->
  <rect x="580" y="380" width="180" height="80" fill="#f5f5f5" stroke="#424242" stroke-width="2" rx="5"/>
  <text x="670" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#424242">
    SYSTEM ACTIONS
  </text>
  <text x="670" y="418" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    OPEN_LONG / OPEN_SHORT
  </text>
  <text x="670" y="433" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    CLOSE_POSITION
  </text>
  <text x="670" y="448" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    NOACTION
  </text>
  
  <!-- Orders (kept in center) -->
  <rect x="300" y="490" width="200" height="60" fill="#e8eaf6" stroke="#3f51b5" stroke-width="2" rx="5"/>
  <text x="400" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#3f51b5">
    ORDINI
  </text>
  <text x="400" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    Qty + Direction + Stop
  </text>
  <text x="400" y="543" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">
    → Broker API
  </text>
  
  <!-- Arrows and Flow -->
  
  <!-- TradeMgr to lifecycle steps -->
  <path d="M 380 100 L 120 140" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 100 L 290 140" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 420 100 L 510 140" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 440 100 L 680 140" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Data sources to steps -->
  <path d="M 100 280 L 120 200" stroke="#0277bd" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 230 280 L 290 200" stroke="#689f38" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 490 280 L 510 200" stroke="#ffa000" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- TradeMgr to IG Gateway (bidirectional) -->
  <path d="M 480 80 L 520 80" stroke="#c2185b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 520 70 L 480 70" stroke="#c2185b" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Processing to Actions (now going to the right) -->
  <path d="M 510 200 L 670 380" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Actions to Orders (from right to center) -->
  <path d="M 580 420 L 500 520" stroke="#424242" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Orders to TradeMgr -->
  <path d="M 400 490 L 400 100" stroke="#3f51b5" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Arrow marker definition (halved size) -->
  <defs>
    <marker id="arrowhead" markerWidth="5" markerHeight="3.5" refX="5" refY="1.75" orient="auto">
      <polygon points="0 0, 5 1.75, 0 3.5" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <text x="50" y="580" font-family="Arial, sans-serif" font-size="10" fill="#666">
    IG Gateway comunica solo con TradeMgr | System riceve eventi tramite TradeMgr
  </text>
  
</svg>
